Netlify + Railway Deployment Checklist
======================================

PHASE 1: RAILWAY BACKEND DEPLOYMENT
===================================

Setup
[ ] 1a. Create Railway account (railway.app)
[ ] 1b. Connect GitHub to Railway
[ ] 1c. Select ejustice_portal repo
[ ] 1d. Click "Deploy now" (Railway auto-detects Procfile)

Add Database
[ ] 2a. Wait for deployment to start building
[ ] 2b. In Railway dashboard, click "+ Add Plugin" or "+ Add Service"
[ ] 2c. Select "MySQL" from plugin list
[ ] 2d. Wait for MySQL to show green "Active" status
[ ] 2e. Railway auto-injects DATABASE_URL into app environment

Environment Variables
[ ] 3a. Click "Variables" tab in Railway project
[ ] 3b. Add:
       DOC_ENC_KEY = [strong 32+ char random string]
       DB_HOST = localhost
       DB_NAME = railway
       DB_USER = root
       DB_PASS = [from Variables, copy it]
       APP_ENV = production
       APP_DEBUG = false

Verify Backend
[ ] 4a. Wait for deployment to complete (shows "Active" status)
[ ] 4b. Click "View Logs" to see PHP server output
[ ] 4c. Copy Railway public URL: https://your-project-name.railway.app
[ ] 4d. Test in browser: https://your-railway-url/login.php
       Expected: login page loads (no 502, 404, blank)

Database Migrations
[ ] 5a. Open phpMyAdmin: https://your-railway-url/phpmyadmin
[ ] 5b. Select "railway" database (left sidebar)
[ ] 5c. Click "Import" tab
[ ] 5d. Upload and run each SQL file (in order):
       1. sql/ejustice_portal.sql
       2. sql/002_add_audit_logs.sql
       3. sql/003_add_barangay_module.sql
       4. sql/004_add_barangay_case_routing.sql
[ ] 5e. Watch for "success" messages after each import
[ ] 5f. Verify tables exist: click database, see ~20+ tables listed


PHASE 2: NETLIFY FRONTEND DEPLOYMENT
====================================

Create Netlify Site
[ ] 6a. Create Netlify account (netlify.com)
[ ] 6b. Click "Add new site" â†’ "Connect to Git"
[ ] 6c. Select GitHub and authorize
[ ] 6d. Select ejustice_portal repo
[ ] 6e. Configure build settings:
       Base directory: (leave blank)
       Build command: (leave blank)
       Publish directory: public
[ ] 6f. Click "Deploy site"
[ ] 6g. Wait for deploy to complete (~1 minute)
[ ] 6h. Copy Netlify domain: https://your-site-name.netlify.app

Update Proxy Rules
[ ] 7a. Edit public/_redirects file locally
[ ] 7b. Find all lines with "BACKEND_URL"
[ ] 7c. Replace BACKEND_URL with your Railway URL:
       Example: https://ejustice-production.railway.app
       (Keep the rest of each line unchanged)
[ ] 7d. Ensure ALL lines updated (count replacements)
[ ] 7e. Commit: git add public/_redirects
[ ] 7f. Commit: git commit -m "Update Railway URL in Netlify proxy"
[ ] 7g. Push: git push origin main
[ ] 7h. Watch Netlify redeploy (Deployments tab)
[ ] 7i. Wait for deploy to complete (~30 seconds)

Verify Frontend
[ ] 8a. Open: https://your-site-name.netlify.app/login.php
       Expected: login page loads (proxied from Railway)
[ ] 8b. Check browser DevTools (F12) â†’ Network tab
       Verify requests show 200 status (not 502, 404)


PHASE 3: SEED & TEST
====================

Seed Demo Users
[ ] 9a. Visit: https://your-site-name.netlify.app/seed_demo_users.php
[ ] 9b. Should see "âœ“ User created" messages (or "already exists" if re-run)
[ ] 9c. Copy demo credentials from page:
       admin@example.com / password
       complainant@example.com / password
       barangay@example.com / password

Test Login
[ ] 10a. Go to: https://your-site-name.netlify.app/login.php
[ ] 10b. Enter: admin@example.com / password
[ ] 10c. Click "Login"
[ ] 10d. Should redirect to dashboard (check URL bar)
[ ] 10e. Reload page (F5) â€” should still be logged in (session persists)

Test Core Features
[ ] 11a. File a Case:
        - Navigate to "File Case" or dashboard case link
        - Fill form (complainant, defendant, category, barangay)
        - Submit â†’ should see "Case filed successfully"

[ ] 11b. Upload Document:
        - Go to "Upload Document" or case page
        - Select a PDF/image file
        - Upload â†’ should encrypt and store

[ ] 11c. View Document:
        - Go to uploaded case
        - Click document link
        - Should decrypt and display
        - Check audit log â†’ "DOCUMENT_DECRYPT" entry created

[ ] 11d. Check Audit Logs:
        - Login as rtcstaff@example.com / password
        - Go to "Audit Logs" page
        - Filter by action or date
        - Should see document decrypt, case filing events

Test Barangay Features
[ ] 12a. Login as barangay@example.com / password
[ ] 12b. Go to "Barangay Dashboard"
[ ] 12c. Should see pending cases (from "File a Case" test)
[ ] 12d. Click a case â†’ "Barangay Mediation"
[ ] 12e. Record mediation attempt
[ ] 12f. Go to "Settlement Form"
[ ] 12g. Generate Kasunduan (Settlement Agreement)
[ ] 12h. Or generate CFA (Certificate to File Action) â€” should escalate to police blotter
[ ] 12i. Verify case now shows in police blotter (police user dashboard)


PHASE 4: CUSTOM DOMAIN & PRODUCTION
===================================

Enable Custom Domain (Optional)
[ ] 13a. Go to Netlify dashboard â†’ Your site â†’ "Site settings"
[ ] 13b. Click "Domain management" â†’ "Add domain"
[ ] 13c. Enter your domain (e.g., ejustice.example.com)
[ ] 13d. Follow DNS setup (update nameservers or CNAME record)
[ ] 13e. Wait for DNS propagation (5 min â€“ 48 hours)
[ ] 13f. Netlify auto-provisions SSL certificate (Let's Encrypt)
[ ] 13g. Verify HTTPS works: https://ejustice.example.com/login.php

Enable HTTPS Redirect (Recommended)
[ ] 14a. Netlify â†’ Site settings â†’ "Redirects and rewrites"
[ ] 14b. Add rule: 
        From: http://YOUR_DOMAIN/*
        To: https://YOUR_DOMAIN/:splat
        Status: 301 (Permanent Redirect)
[ ] 14c. Save and test: http://your-domain.com should redirect to https

Set Up Backups
[ ] 15a. Railway â†’ Your project â†’ MySQL service
[ ] 15b. Check "Backups" section
[ ] 15c. Verify daily backups are enabled (default)
[ ] 15d. Download a backup (optional, for off-site storage)

Monitor Performance
[ ] 16a. Netlify â†’ Analytics (view traffic, deploy times)
[ ] 16b. Railway â†’ Usage tab (view CPU, memory, disk)
[ ] 16c. Set up notifications for errors (optional)


TROUBLESHOOTING
===============

Symptom: "404 Not Found" on Netlify login page
Solution:
  [ ] Check Railway URL in public/_redirects is correct
  [ ] Verify Railway backend is still running (check status)
  [ ] Test directly: curl https://your-railway-url/login.php
  [ ] Check Netlify deploy logs for proxy errors

Symptom: "502 Bad Gateway"
Solution:
  [ ] Check Railway logs: Deployments â†’ View Logs
  [ ] Restart Railway service
  [ ] Verify MySQL is Active (green)
  [ ] Check DATABASE_URL in Railway Variables

Symptom: Session lost after login (logged out after redirect)
Solution:
  [ ] Verify config/config.php has correct session settings
  [ ] Check "Set-Cookie" header in DevTools Network tab
  [ ] Ensure cookie domain is NOT fixed to Railway domain
  [ ] Try clearing browser cookies and re-login

Symptom: Document upload fails
Solution:
  [ ] Check storage/documents folder permissions
  [ ] If Railway (ephemeral storage), set up volume or use S3
  [ ] Check upload_max_filesize in PHP (should be 100M+)
  [ ] Check Rails logs for errors


MAINTENANCE
===========

Monthly Tasks
[ ] Check audit logs (anomalies, failed logins)
[ ] Review resource usage (Netlify + Railway dashboards)
[ ] Test backup restoration (once)

Quarterly Tasks
[ ] Update PHP version (if available in Railway)
[ ] Review and update DOC_ENC_KEY (or rotate if compromised)
[ ] Check for PHP/MySQL security patches

Deployment Workflow (Ongoing)
[ ] Make code changes locally
[ ] Test on XAMPP (local environment)
[ ] Commit: git add . && git commit -m "..."
[ ] Push: git push origin main
[ ] Watch Netlify + Railway auto-deploy (both in parallel)
[ ] Test on production: https://your-site-name.netlify.app


DONE! ðŸŽ‰
========
Your eJustice Portal is live on Netlify + Railway!
Every git push auto-deploys both frontend and backend.

Questions?
- Railway Docs: https://docs.railway.app
- Netlify Docs: https://docs.netlify.com
- App Docs: See NETLIFY_RAILWAY_GUIDE.md
